# åŸå‹é“¾

<img src="../imgs/åŸå‹é“¾.png" style="height: 300px; float: left" alt="åŸå‹é“¾"  />

```js
function Person() {

}

var person = new Person();

console.log(person.__proto__ == Person.prototype) // true

console.log(Person.prototype.constructor == Person) // true

console.log(Object.getPrototypeOf(person) === Person.prototype) // true
```

# ä½œç”¨åŸŸ

ä½œç”¨åŸŸæ˜¯æŒ‡ç¨‹åºæºä»£ç ä¸­å®šä¹‰å˜é‡çš„åŒºåŸŸã€‚

ä½œç”¨åŸŸè§„å®šäº†å¦‚ä½•æŸ¥æ‰¾å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚

JavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸ`(lexical scoping`)ï¼Œä¹Ÿå°±æ˜¯é™æ€ä½œç”¨åŸŸï¼›**å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å†³å®šäº†**ï¼›



ä¸è¯æ³•ä½œç”¨åŸŸç›¸å¯¹çš„æ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å†³å®šäº†

```js
var value = 1;

function foo() {
    console.log(value);
}

function bar() {
    var value = 2;
    foo();
}

bar();

// ç»“æœæ˜¯ ???
```

ç»“æœæ˜¯1 ï¼Œ å› ä¸ºåœ¨æ‰§è¡Œåˆ°fooçš„æ—¶å€™ï¼Œå°±ä¼šæŸ¥æ‰¾fooå†…éƒ¨æœ‰æ²¡æœ‰valueå˜é‡ã€‚æ²¡æœ‰å°±ç½‘ä¸Šæ‰¾ï¼Œæ‰¾åˆ°äº†1ï¼›

å› ä¸ºæ˜¯é™æ€ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨å®šä¹‰å‡½æ•°çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ï¼Œæ ¹æœ¬ä¸ç®¡å®ƒåœ¨æ‰§è¡Œæ—¶åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼›

å¦‚æœæ˜¯åŠ¨æ€ä½œç”¨åŸŸçš„è¯ï¼Œåˆ™ä¼šåœ¨è°ƒç”¨å‡½æ•°çš„ä½œç”¨åŸŸbarå‡½æ•°ä¸­æŸ¥æ‰¾ï¼Œç»“æœæ‰¾åˆ°äº†2ï¼Œå°±ä¼šæ‰“å°2è€Œä¸æ˜¯1

è¿™å°±æ˜¯åŠ¨æ€ä½œç”¨åŸŸå’Œé™æ€ä½œç”¨åŸŸçš„åŒºåˆ«ã€‚



```js
// case 1
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f();
}
checkscope();

// case 2
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f;
}
checkscope()();
```

**JavaScript å‡½æ•°çš„æ‰§è¡Œç”¨åˆ°äº†ä½œç”¨åŸŸé“¾ï¼Œè¿™ä¸ªä½œç”¨åŸŸé“¾æ˜¯åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™åˆ›å»ºçš„ã€‚åµŒå¥—çš„å‡½æ•° f() å®šä¹‰åœ¨è¿™ä¸ªä½œç”¨åŸŸé“¾é‡Œï¼Œå…¶ä¸­çš„å˜é‡ scope ä¸€å®šæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ç®¡ä½•æ—¶ä½•åœ°æ‰§è¡Œå‡½æ•° f()ï¼Œè¿™ç§ç»‘å®šåœ¨æ‰§è¡Œ f() æ—¶ä¾ç„¶æœ‰æ•ˆã€‚**

ç¬¬äºŒæ®µä»£ç ï¼š`f` å‡½æ•°è¢«è¿”å›å¹¶åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œä½†å®ƒä»ç„¶é—­åŒ…äº† `checkscope` å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå› æ­¤è¿”å›å€¼è¿˜æ˜¯ `"local scope"`ã€‚å»¶è¿Ÿè°ƒç”¨ä¸ä¼šå½±å“é—­åŒ…çš„è¡Œä¸º



# å˜é‡æå‡

### ğŸ‘€ **å…·ä½“åˆ†æ**

```js
function foo() {
    console.log('foo1');
}

foo();  // ?

function foo() {
    console.log('foo2');
}

foo();  // ?
```

âœ… åœ¨æ‰§è¡Œå‰ï¼Œè§£é‡Šå™¨ä¼šå…ˆæŠŠæ‰€æœ‰å‡½æ•°å£°æ˜æå‡åˆ°ä½œç”¨åŸŸé¡¶éƒ¨ï¼Œå˜æˆè¿™æ ·ï¼ˆé€»è¾‘ä¸Šï¼‰ï¼š

```js
function foo() {
    console.log('foo2');
}

// ä¸Šé¢ foo çš„å®šä¹‰å·²ç»è¦†ç›–äº†ä¸‹é¢çš„

// ç¬¬ä¸€å¤„è°ƒç”¨
foo(); // foo2

// ç¬¬äºŒå¤„è°ƒç”¨
foo(); // foo2
```

- **ç¬¬ä¸€æ¬¡è°ƒç”¨ foo()** æ—¶ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯ `console.log('foo2')`
- **ç¬¬äºŒæ¬¡è°ƒç”¨ foo()** æ—¶ï¼Œä¾ç„¶æ‰§è¡Œ `console.log('foo2')`



# æ‰‹å†™callå’Œapply

é‡ç‚¹åœ¨äºåˆ›å»ºä¸€ä¸ªsimbleï¼Œå°†å‡½æ•°èµ‹å€¼ä¸contextçš„simbleå±æ€§ä¸­ï¼Œè°ƒç”¨è¿™ä¸ªsimbleå±æ€§ï¼Œç„¶ååˆ é™¤è¿™ä¸ªsimble

## call

```js
Function.prototype.myCall = (context) {
  if (context == null) {
    context = window
  }
  const arg = [...arguments].slice(1)
  const fnSymbol = Symbol('fn')
  context[fnSymbol] = this
  
  const result =  context[fnSymbol](...arg)
  delete context[fnSymbol]
  return result
}
```



## apply

```js
Function.prototype.myApply = function (context, args) {
  if (context == null) {
    context = window
  }
  const fnSymbol = Symbol('fn')
  context[fnSymbol] = this
  
  const result =  context[fnSymbol](...args)
  delete context[fnSymbol]
  return result
}
```



# æ‰‹å†™bind

```js
Function.prototype.MyBind = function (context, ...args1) {
  const originFn = this

  function boundFn(...args2) {
    const isNew = this instanceof boundFn

    // å¦‚æœæ˜¯ new è°ƒç”¨ï¼Œåˆ™ this ä¸ºæ–°å¯¹è±¡ï¼›å¦åˆ™æ˜¯ context
    const thisArg = isNew ? this : context || globalThis

    // æ„é€ ä¸€ä¸ªå”¯ä¸€çš„ä¸´æ—¶å±æ€§åï¼ˆSymbol é¿å…å†²çªï¼‰
    const tempKey = Symbol('boundFunction')
    thisArg[tempKey] = originFn

    // å±•å¼€å‚æ•°å¹¶è°ƒç”¨
    const result = thisArg[tempKey](...args1, ...args2)

    // åˆ é™¤ä¸´æ—¶å±æ€§
    delete thisArg[tempKey]

    return result
  }

  // åŸå‹ç»§æ‰¿ä¿æŒä¸€è‡´
  boundFn.prototype = Object.create(originFn.prototype)

  return boundFn
}

```





# é—­åŒ…

**èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡ï¼ˆä¸åœ¨å‡½æ•°å†…éƒ¨ä¸”ä¸æ˜¯å‡½æ•°å‚æ•°çš„å˜é‡ï¼‰çš„å‡½æ•°**

